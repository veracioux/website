# -*- mode: dockerfile; -*- vim: filetype=dockerfile

source shDockerfile.common.in

# ------------------------------------------------------------------------------
FROM build-base as build
RUN --mount=type=cache,id=pnpm,target=/pnpm/store \
    pnpm run server:build
# ------------------------------------------------------------------------------
FROM prod-base

RUN apk add --no-cache curl

COPY --from=build /worker/server.js ./
COPY --from=prod-deps /worker/node_modules ./

CMD node ./server.js
