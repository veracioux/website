#!/usr/bin/env sh

cd "$(tem find -b website)"

rsync -v .env/*.secret "$VPS_IP":/home/haris/website/.env/
rsync -v worker/.env/*.secret "$VPS_IP":/home/haris/website/worker/.env/
rsync -v mail/config.secret.conf "$VPS_IP":/home/haris/website/mail/

connect "mkdir -p ~/auth/"
connect "echo > ~/auth/htpasswd"

for file in .tem/files/passwords/*; do
    user="$(basename ${file%%.gpg})"
    lpass show "$user" | connect "htpasswd -Bi ~/auth/htpasswd $user"
done
