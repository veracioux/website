#!/usr/bin/env bash

# Generate dockerfiles from shDockerfile

project_root="$(tem find -b website)"

process_types=("$@")

if [ -z "$process_types" ]; then
    process_types=(web worker_dotfiles mail)
fi

export ENVIRONMENT="$(tem var env)"
export MACHINE="$(tem var device)"

mkdir -p _docker

for process_type in "${process_types[@]}"; do
    echo "Generating _docker/Dockerfile.$process_type.$ENVIRONMENT ..."
    shdocker \
        -s "$project_root/docker/shDockerfile.$process_type" \
        -d "$project_root/_docker/Dockerfile.$process_type.$ENVIRONMENT"
done
