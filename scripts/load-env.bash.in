#!/usr/bin/env bash

[ -z "$ENV" ] && ENV=staging

print_and_eval() {
    echo "$1"
    eval "$1"
}

load_envvars_from_file() {
    for file in "$@"; do
        print_and_eval "$(sed 's/^.\+=.\+/export &/' "$file")"
    done
}

for file in \
    .env.d/common \
    .env.d/staging \
    .env.d/"$ENV"{,.secret}
do
    [ -f "$file" ] && load_envvars_from_file "$file"
done
